<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{fragments/header :: headerFragment}"></div>
<body>
<main>
    <nav th:replace="~{fragments/sidebar :: sidebarFragment}"></nav>
    <section class="content">
        <div class="left-content">
            <div class="activities">
                <h1>회원 관리</h1>
                <div>
                    <form id="actionForm" th:action="@{/admin/member}" th:object="${condition}" method="get">
                        <div class="form-row">
                            <label for="startDate">가입날짜:</label>
                            <input type="date" id="startDate" name="startDate" th:value="*{startDate}"/>
                            ~
                            <input type="date" id="endDate" name="endDate" th:value="*{endDate}"/>

                            <label for="sex">성별:</label>
                            <select id="sex" name="sex">
                                <option value="">전체</option>
                                <option th:each="sex : ${T(b172.challenging.member.domain.Sex).values()}"
                                        th:value="${sex}" th:text="${sex.getKey()}"
                                        th:selected="${condition.sex() eq sex}"/>
                            </select>

                            <label for="isLeaved">회원상태:</label>
                            <select id="isLeaved" name="isLeaved">
                                <option value="">전체</option>
                                <option value="false">정상</option>
                                <option value="true">탈퇴</option>
                            </select>

                            <label for="oauthProvider">SNS 종류:</label>
                            <select id="oauthProvider" name="oauthProvider">
                                <option value="">전체</option>
                                <option th:each="provider : ${T(b172.challenging.member.domain.OauthProvider).values()}"
                                        th:value="${provider}" th:text="${provider}"
                                        th:selected="${condition.oauthProvider() eq provider}"/>
                            </select>
                        </div>

                        <!-- 두 번째 라인: 검색조건(셀렉트박스), 검색 내용(쿼리) -->
                        <div>
                            <label for="searchCriteria">검색조건:</label>
                            <select id="searchCriteria" name="searchCriteria">
                                <option value="">전체</option>
                                <option th:value="nickname"
                                        th:text="닉네임"
                                        th:selected="${condition.searchCriteria() eq 'nickname'}" />
                            </select>

                            <label for="searchQuery">검색 내용:</label>
                            <input type="text" id="searchQuery" name="searchQuery" th:value="*{searchQuery}" placeholder="Search Query" />

                            <button th:type="button" th:onclick="'submitFormWithAction(\'' + @{/admin/member} + '\'' + ')'">검색</button>

<!--                             <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->
                            <input type="hidden" name="page" id="page" value="0" />
                            <input type="hidden" name="size" id="size" value="5" />
                        </div>
                    </form>
                    <br>
                    <div th:text="'총 ' + ${members.totalElements()} + ' 건'"/>
                    <table th:if="${!members.list().isEmpty()}">
                        <caption th:text="${title}">회원 관리</caption>
                        <thead>
                        <tr>
                            <th>회원번호</th>
                            <th>SNS 타입</th>
                            <th>닉네임</th>
                            <th>나이(년생)</th>
                            <th>성별</th>
                            <th>회원상태</th>
                            <th>가입일</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="member : ${members.list()}">
                            <td><a th:href="@{/admin/member/{id}(id=${member.id})}" th:text="${member.id}">2</a></td>
                            <td th:text="${member.oauthProvider}">구글</td>
                            <td th:text="${member.nickName}">행복한 토끼</td>
                            <td th:text="${member.birthYear}">1999</td>
                            <td th:text="${member.sex.getKey()}">선택안함</td>
                            <td th:text="${member.isLeaved}">정상</td>
                            <td th:text="${#temporals.format(member.createdAt,'yyyy-MM-dd HH:mm')}">2024-03-19</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="left-bottom">
                <div class="pagination" th:if="${members.totalPages > 1}">
                    <div th:if="${members.hasPrevious()}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${members.number - 1} + '\'' + ')'" class="prev">&#10094; Previous</button>
                    </div>
                    <span th:if="${members.number > 2 && members.totalPages > 5}">...</span>
                    <div th:each="currPage : ${#numbers.sequence(members.number > 2 ? (members.totalPages - members.number > 2 ? members.number - 2 : (members.totalPages > 5 ? members.totalPages - 5 : 0)) : 0, members.number > 2 ? (members.totalPages - members.number > 2 ? members.number + 2 : members.totalPages - 1) : (members.totalPages > 5 ? 4 : members.totalPages - 1))}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${currPage} +'\'' + ')'" th:class="${members.number == currPage ? 'active' : ''}" th:text="${currPage + 1}"/>
                    </div>
                    <span th:if="${members.number < members.totalPages - 3 && members.totalPages > 5}">...</span>
                    <div th:if="${members.hasNext()}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${members.number + 1} +'\'' + ')'" class="next">Next &#10095;</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
</body>
</html>
