<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{fragments/header :: headerFragment}"></div>
<body>
<main>
    <nav th:replace="~{fragments/sidebar :: sidebarFragment}"></nav>
    <section class="content">

        <div class="left-content">
            <div class="activities">
                <h1>방 관리</h1>
                <div>
                    <form id="actionForm" th:action="@{/admin/gathering}" th:object="${condition}" method="get">
                        <div class="form-row">
                            <label for="startDate">모임 만든날짜:</label>
                            <input type="date" id="startDate" name="startDate" th:value="*{startDate}"/>
                            ~
                            <input type="date" id="endDate" name="endDate" th:value="*{endDate}"/>

                            <label for="appTechPlatform">성별:</label>
                            <select id="appTechPlatform" name="appTechPlatform">
                                <option value="">전체</option>
                                <option th:each="appTechPlatform : ${T(b172.challenging.gathering.domain.AppTechPlatform).values()}"
                                        th:value="${appTechPlatform}" th:text="${appTechPlatform.getKey()}"
                                        th:selected="${condition.appTechPlatform() eq appTechPlatform}"/>
                            </select>

                            <label for="gatheringStatus">상태:</label>
                            <select id="gatheringStatus" name="gatheringStatus">
                                <option value="">전체</option>
                                <option th:each="gatheringStatus : ${T(b172.challenging.gathering.domain.GatheringStatus).values()}"
                                        th:value="${gatheringStatus}" th:text="${gatheringStatus.getKey()}"
                                        th:selected="${condition.gatheringStatus() eq gatheringStatus}"/>
                            </select>
                        </div>

                        <!-- 두 번째 라인: 검색조건(셀렉트박스), 검색 내용(쿼리) -->
                        <div>
                            <label for="searchCriteria">검색조건:</label>
                            <select id="searchCriteria" name="searchCriteria">
                                <option value="">전체</option>
                                <option th:value="owner_nickname"
                                        th:text="방장"
                                        th:selected="${condition.searchCriteria() eq 'owner_nickname'}" />
                                <option th:value="title"
                                        th:text="제목"
                                        th:selected="${condition.searchCriteria() eq 'title'}" />
                                <option th:value="nickname"
                                        th:text="참가자"
                                        th:selected="${condition.searchCriteria() eq 'nickname'}" />
                            </select>

                            <label for="searchQuery">검색 내용:</label>
                            <input type="text" id="searchQuery" name="searchQuery" th:value="*{searchQuery}" placeholder="Search Query" />

                            <button th:type="button" th:onclick="'submitFormWithAction(\'' + @{/admin/gathering} + '\'' + ')'">검색</button>

                            <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->
                            <input type="hidden" name="page" id="page" value="0" />
                            <input type="hidden" name="size" id="size" value="5" />
                        </div>
                    </form>
                    <br>
                    <label th:text="'총 ' + ${gatherings.totalElements()} + ' 건'"/>
                    <div class="right-align">
                        <button th:onclick="'window.location.href=\'' + @{/admin/gathering/create} + '\''">방 생성</button>
                    </div>
                    <table th:if="${!gatherings.list().isEmpty()}">
                        <caption>회원 관리</caption>
                        <thead>
                        <tr>
                            <th>번호</th>
                            <th>방 이름</th>
                            <th>방장 이름</th>
                            <th>플랫폼</th>
                            <th>목표금액</th>
                            <th>시작일자</th>
                            <th>종료일자</th>
                            <th>기간</th>
                            <th>진행 상태</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="gathering : ${gatherings.list()}">
                            <td><a th:href="@{/admin/gathering/{id}(id=${gathering.id})}" th:text="${gathering.id}">2</a></td>
                            <td th:text="${gathering.title}"/>
                            <td th:text="${gathering.ownerMember.nickname}"/>
                            <td th:text="${gathering.platform.getKey()}"/>
                            <td th:text="${gathering.goalAmount} + ' 원'"/>
                            <td th:text="${#temporals.format(gathering.startDate,'yyyy-MM-dd HH:mm')}"/>
                            <td th:text="${#temporals.format(gathering.endDate,'yyyy-MM-dd HH:mm')}"/>
                            <td th:text="${gathering.workingDays} + ' 일'"/>
                            <td th:text="${gathering.gatheringStatus.getKey()}"/>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="left-bottom">
                <div class="pagination" th:if="${gatherings.totalPages > 1}">
                    <div th:if="${gatherings.hasPrevious()}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${gatherings.number - 1} + '\'' + ')'" class="prev">&#10094; Previous</button>
                    </div>
                    <span th:if="${gatherings.number > 2 && gatherings.totalPages > 5}">...</span>
                    <div th:each="currPage : ${#numbers.sequence(gatherings.number > 2 ? (gatherings.totalPages - gatherings.number > 2 ? gatherings.number - 2 : (gatherings.totalPages > 5 ? gatherings.totalPages - 5 : 0)) : 0, gatherings.number > 2 ? (gatherings.totalPages - gatherings.number > 2 ? gatherings.number + 2 : gatherings.totalPages - 1) : (gatherings.totalPages > 5 ? 4 : gatherings.totalPages - 1))}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${currPage} +'\'' + ')'" th:class="${gatherings.number == currPage ? 'active' : ''}" th:text="${currPage + 1}"/>
                    </div>
                    <span th:if="${gatherings.number < gatherings.totalPages - 3 && gatherings.totalPages > 5}">...</span>
                    <div th:if="${gatherings.hasNext()}">
                        <button th:type="button" th:onclick="'movePage(\''+ ${gatherings.number + 1} +'\'' + ')'" class="next">Next &#10095;</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
</body>
</html>
